"use strict";function _gyro_scene(){var e=this;e.scene=new THREE.Scene,e.gravity=new THREE.Vector3(0,-64,0);var r=new THREE.AxisHelper(32);e.init=function(){e.scene.add(r)},e.physics=function(){}}function _gyro_renderer(e){var r=e.gyroRenderer=this;r.renderer=new THREE.WebGLRenderer,$("#canvas").append(r.renderer.domElement),r.dime=function(){window.innerWidth/window.innerHeight>16/9?r.renderer.setSize(window.innerHeight*(16/9),window.innerHeight):r.renderer.setSize(window.innerWidth,window.innerWidth*(9/16))},r.init=function(){r.renderer.shadowMap.enabled=!0,r.renderer.shadowMap.type=THREE.PCFSoftShadowMap,r.dime(),$(r.dime),$(window).resize(r.dime)},r.physics=function(){}}function _gyro_lights(e){var r=e.gyroLights=this;r.light1=new THREE.DirectionalLight(16777215,.4),r.light1Position=new THREE.Vector3(512,512,512),r.light2=new THREE.AmbientLight(16777215,1.2),r.init=function(){r.light1.position.set(r.light1Position.x,r.light1Position.y,r.light1Position.z),r.light1.rotation.x=Math.PI,r.light1.castShadow=!0,e.scene.add(r.light1),e.scene.add(r.light2)},r.physics=function(){}}function _gyro_camera(e){var r=e.gyroCamera=this;r.radius=384,r.phi=Math.PI/3,r.theta=0,e.camera=new THREE.PerspectiveCamera(60,16/9,1,8192),r.init=function(){$("#canvas").on("scroll touchmove mousewheel",function(e){return e.preventDefault(),e.stopPropagation(),e.delta=null,e.originalEvent&&(e.originalEvent.wheelDelta&&(e.delta=e.originalEvent.wheelDelta/-40),e.originalEvent.deltaY&&(e.delta=e.originalEvent.deltaY),e.originalEvent.detail&&(e.delta=e.originalEvent.detail)),null!=e.delta&&(r.radius-=e.delta,r.radius<32&&(r.radius=32),r.radius>1024&&(r.radius=1024)),!1}),$(document).on("keydown",function(e){switch(e.keyCode){case 187:r.radius-=32,r.radius<32&&(r.radius=32);break;case 189:r.radius+=32,r.radius>1024&&(r.radius=1024);break;case 38:r.phi-=Math.PI/180*5,r.phi<Math.PI*(5/180)&&(r.phi=Math.PI*(5/180));break;case 40:r.phi+=Math.PI/180*5,r.phi>Math.PI-Math.PI*(30/180)&&(r.phi=Math.PI-Math.PI*(30/180));break;case 37:r.theta-=Math.PI/180*5;break;case 39:r.theta+=Math.PI/180*5}})},r.physics=function(){var o=(new THREE.Vector3).setFromSpherical(new THREE.Spherical(r.radius,r.phi,r.theta));e.camera.position.set(o.x,o.y,o.z),e.camera.lookAt(new THREE.Vector3(e.group.position.x,e.group.position.y/2,e.group.position.z))}}function _gyro_gyro(e){var r=e.gyroGyro=this;e.isTranslucent=!0,$('#form input[name="malpha"').prop("checked",e.isTranslucent),e.rotationalAcceleration=Math.PI/180*.005,e.rotationalVelocity=256*e.rotationalAcceleration,e.precessionVelocity=0,r.radiusHolder=16,r.heightTopHolder=48,r.heightBottomHolder=96,e.orbitRadius=96,e.numberOfSpheres=16,e.sphereRadius=16,e.spheres=[],e.angle=0,e.angleMax=Math.atan(e.orbitRadius/r.heightBottomHolder),r.isAccelerating=!1,e.group=new THREE.Object3D,e.pivot=new THREE.Object3D,r.init=function(){(i=new THREE.Mesh(new THREE.CylinderGeometry(4,12,12228,8*e.numberOfSpheres),new THREE.MeshPhysicalMaterial({color:16777215,transparent:!0,opacity:.2,side:THREE.DoubleSide}))).castShadow=!0,i.receiveShadow=!0,i.position.y=-6114,i.updateMatrix(),e.scene.add(i);var o=new THREE.Geometry;(i=new THREE.Mesh(new THREE.TorusGeometry(e.orbitRadius,e.sphereRadius,16,e.numberOfSpheres))).castShadow=!0,i.receiveShadow=!0,i.rotation.x=Math.PI/2,i.updateMatrix(),o.merge(i.geometry,i.matrix),(i=new THREE.Mesh(new THREE.CylinderGeometry(e.orbitRadius,e.orbitRadius,2,8*e.numberOfSpheres))).castShadow=!0,i.receiveShadow=!0,i.updateMatrix(),o.merge(i.geometry,i.matrix),e.centerGroup=new THREE.Mesh(o,new THREE.MeshPhysicalMaterial),e.group.add(e.centerGroup),(i=new THREE.Mesh(new THREE.CylinderGeometry(r.radiusHolder,r.radiusHolder,r.heightTopHolder,8*e.numberOfSpheres),new THREE.MeshPhysicalMaterial({color:10255422}))).castShadow=!0,i.receiveShadow=!0,i.position.y=r.heightTopHolder/2,e.group.add(i),(i=new THREE.Mesh(new THREE.CylinderGeometry(r.radiusHolder,0,r.heightBottomHolder,8*e.numberOfSpheres),new THREE.MeshPhysicalMaterial({color:10255422}))).castShadow=!0,i.receiveShadow=!0,i.position.y=-r.heightBottomHolder/2,e.group.add(i);for(var t=0;t<e.numberOfSpheres;t++){var i;i=new THREE.Mesh(new THREE.SphereGeometry(.8*e.sphereRadius,16,8),new THREE.MeshLambertMaterial({color:16777215,transparent:!0,opacity:.4}));var a=e.orbitRadius,n=Math.PI/2,c=t/e.numberOfSpheres*(2*Math.PI),s=(new THREE.Vector3).setFromSpherical(new THREE.Spherical(a,n,c));i.castShadow=!0,i.receiveShadow=!0,i.position.set(s.x,s.y,s.z),e.spheres.push(i),e.group.add(i)}e.group.position.y=r.heightBottomHolder,e.pivot.add(e.group),e.pivot.rotation.z=this.angle,e.scene.add(e.pivot),$('#form input[name="malpha"').click(function(r){$(this).is(":checked")?e.isTranslucent=!0:e.isTranslucent=!1}),$('#form input[name="snutation"').change(function(){$(this).val();e.angle=-$(this).val()/180*Math.PI}),$(document).on("keydown",function(o){switch(o.keyCode){case 49:case 50:case 51:case 52:case 53:case 54:e.angle=-(o.keyCode-49)*(Math.PI/180)*10,$('#form input[name="snutation"]').prop("checked",!1),$('#form input[name="snutation"][value="'+10*(o.keyCode-49)+'"]').prop("checked",!0);break;case 32:r.isAccelerating=!0}}),$(document).on("keyup",function(e){switch(e.keyCode){case 32:r.isAccelerating=!1}})},r.physics=function(){e.pause||(r.isAccelerating&&(e.rotationalVelocity+=e.rotationalAcceleration*e.frameRateScale),e.group.rotation.y+=e.rotationalVelocity*e.frameRateScale,e.pivot.rotation.y-=e.precessionVelocity*e.frameRateScale),e.isTranslucent?(e.centerGroup.material.color.set(16777215),e.centerGroup.material.transparent=!0,e.centerGroup.material.opacity=.1,e.centerGroup.material.side=THREE.DoubleSide,e.centerGroup.material.depthWrite=!1):(e.centerGroup.material.color.set(13421772),e.centerGroup.material.transparent=!1,e.centerGroup.material.opacity=1,e.centerGroup.material.side=THREE.SingleSide,e.centerGroup.material.depthWrite=!0),e.pivot.rotation.z=e.angle}}function _gyro_arrows(e){var r=e.gyroArrows=this;r.arrowHelperAccelerationGravity=[],r.arrowHelperAccelerationRotational=[],r.arrowHelperReferenceTorqueArm=[],r.arrowHelperReferenceTorqueAxis=null,r.arrowHelperTorque=[],r.arrowHelperTorqueVertical=[],r.arrowHelperVeclotyRotational=[],r.arrowHelperVelocityPrecession=[],e.pivot.updateMatrixWorld(),e.group.updateMatrixWorld();for(var o,t=0;t<e.numberOfSpheres;t++)r.arrowHelperAccelerationGravity.push(new THREE.ArrowHelper(e.gravity,new THREE.Vector3(0,0,0),e.gravity.length(),255)),r.arrowHelperAccelerationGravity[t].visible=!1,r.arrowHelperAccelerationRotational.push(new THREE.ArrowHelper(new THREE.Vector3(0,1,0),new THREE.Vector3(0,0,0),1,65280)),r.arrowHelperAccelerationRotational[t].visible=!1,r.arrowHelperTorque.push(new THREE.ArrowHelper(new THREE.Vector3(0,1,0),new THREE.Vector3(0,0,0),1,16776960)),r.arrowHelperTorque[t].visible=!1,r.arrowHelperTorqueVertical.push(new THREE.ArrowHelper(new THREE.Vector3(0,1,0),new THREE.Vector3(0,0,0),1,16776960)),r.arrowHelperTorqueVertical[t].visible=!1,(o=new THREE.Geometry).vertices.push(new THREE.Vector3(0,0,0),new THREE.Vector3(0,512,512)),o.computeLineDistances(),r.arrowHelperReferenceTorqueArm.push(new THREE.Line(o,new THREE.LineDashedMaterial({color:6710886,linewidth:1,scale:1,dashSize:8,gapSize:4}))),r.arrowHelperReferenceTorqueArm[t].geometry.dynamic=!0,r.arrowHelperReferenceTorqueArm[t].visible=!1,r.arrowHelperVeclotyRotational.push(new THREE.ArrowHelper(new THREE.Vector3(0,1,0),new THREE.Vector3(0,0,0),1,65280)),r.arrowHelperVeclotyRotational[t].visible=!1,r.arrowHelperVelocityPrecession.push(new THREE.ArrowHelper(new THREE.Vector3(0,1,0),new THREE.Vector3(0,0,0),1,16711935)),r.arrowHelperVelocityPrecession[t].visible=!1;(o=new THREE.Geometry).vertices.push(new THREE.Vector3(0,0,0)),o.vertices.push(new THREE.Vector3(0,1,0)),o.computeLineDistances(),r.arrowHelperReferenceTorqueAxis=new THREE.Line(o,new THREE.LineDashedMaterial({color:6710886,linewidth:1,scale:1,dashSize:8,gapSize:4})),r.arrowHelperReferenceTorqueAxis.geometry.dynamic=!0,r.arrowHelperReferenceTorqueAxis.visible=!1,r.init=function(){for(var o=0;o<e.numberOfSpheres;o++)e.scene.add(r.arrowHelperAccelerationGravity[o]),e.scene.add(r.arrowHelperAccelerationRotational[o]),e.scene.add(r.arrowHelperTorque[o]),e.scene.add(r.arrowHelperTorqueVertical[o]),e.scene.add(r.arrowHelperReferenceTorqueArm[o]),e.scene.add(r.arrowHelperVeclotyRotational[o]),e.scene.add(r.arrowHelperVelocityPrecession[o]);e.scene.add(r.arrowHelperReferenceTorqueAxis),$('#form input[name="fgravity"').click(function(e){$(this).is(":checked")?$(r.arrowHelperAccelerationGravity).each(function(e,r){r.visible=!0}):$(r.arrowHelperAccelerationGravity).each(function(e,r){r.visible=!1})}),$('#form input[name="frotational"').click(function(e){$(this).is(":checked")?$(r.arrowHelperAccelerationRotational).each(function(e,r){r.visible=!0}):$(r.arrowHelperAccelerationRotational).each(function(e,r){r.visible=!1})}),$('#form input[name="ftorque"').click(function(e){$(this).is(":checked")?$(r.arrowHelperTorque).each(function(e,r){r.visible=!0}):$(r.arrowHelperTorque).each(function(e,r){r.visible=!1})}),$('#form input[name="ftorquevertical"').click(function(e){$(this).is(":checked")?$(r.arrowHelperTorqueVertical).each(function(e,r){r.visible=!0}):$(r.arrowHelperTorqueVertical).each(function(e,r){r.visible=!1})}),$('#form input[name="ftorquereference"').click(function(e){$(this).is(":checked")?($(r.arrowHelperReferenceTorqueArm).each(function(e,r){r.visible=!0}),r.arrowHelperReferenceTorqueAxis.visible=!0):($(r.arrowHelperReferenceTorqueArm).each(function(e,r){r.visible=!1}),r.arrowHelperReferenceTorqueAxis.visible=!1)}),$('#form input[name="mrotational"').click(function(e){$(this).is(":checked")?$(r.arrowHelperVeclotyRotational).each(function(e,r){r.visible=!0}):$(r.arrowHelperVeclotyRotational).each(function(e,r){r.visible=!1})}),$('#form input[name="mprecession"').click(function(e){$(this).is(":checked")?$(r.arrowHelperVelocityPrecession).each(function(e,r){r.visible=!0}):$(r.arrowHelperVelocityPrecession).each(function(e,r){r.visible=!1})}),$("#form input:checked").click().click()},r.physics=function(){e.pivot.updateMatrixWorld(),e.group.updateMatrixWorld();var o=(new THREE.Vector3).setFromMatrixPosition(e.group.matrixWorld);e.precessionVelocity=2*(Math.log(Math.cos(0))-Math.log(Math.cos(e.angleMax)))*Math.sin(e.angle)/(1024*Math.pow(e.rotationalVelocity,2)*64);for(var t=0;t<e.numberOfSpheres;t++){e.spheres[t].updateMatrixWorld();var i=t/e.numberOfSpheres*(2*Math.PI)+e.group.rotation.y,a=(new THREE.Vector3).setFromMatrixPosition(e.spheres[t].matrixWorld),n=o.clone().sub(a).cross(a),c=e.gyroGyro.isAccelerating?550040*e.rotationalAcceleration:1e-8,s=(new THREE.Vector3).setFromSpherical(new THREE.Spherical(1,Math.PI/2,e.pivot.rotation.y)),l=(new THREE.Vector3).setFromSpherical(new THREE.Spherical(e.orbitRadius*Math.cos(i),Math.PI/2,e.pivot.rotation.y)),p=s.clone().cross(a).multiplyScalar(Math.sin(e.angle)),h=p.length(),u=(a.distanceTo(l),a.clone().sub(l).angleTo(o));Math.sin(i)<0&&(u=-u);var d=o.clone().normalize().dot(p),w=o.clone().multiplyScalar(d),m=1024*e.rotationalVelocity,y=(Math.log(Math.cos(u))-Math.log(Math.cos(e.angleMax)))*Math.sin(e.angle)/(4*Math.pow(e.rotationalVelocity,2));Math.cos(i)>0&&(y=-y);var H=o.clone().normalize().multiplyScalar(y);0==h&&(h=1e-8),0==m&&(m=1e-8),0==(d=Math.abs(d))&&(d=1e-8),0==(y=Math.abs(y))&&(y=1e-8),r.arrowHelperAccelerationGravity[t].position.set(a.x,a.y,a.z),r.arrowHelperAccelerationGravity[t].setDirection(e.gravity.clone().normalize()),r.arrowHelperAccelerationGravity[t].setLength(e.gravity.length()),r.arrowHelperAccelerationRotational[t].position.set(a.x,a.y,a.z),r.arrowHelperAccelerationRotational[t].setDirection(n.clone().normalize()),r.arrowHelperAccelerationRotational[t].setLength(c),r.arrowHelperTorque[t].position.set(a.x,a.y,a.z),r.arrowHelperTorque[t].setDirection(p.clone().normalize()),r.arrowHelperTorque[t].setLength(h),r.arrowHelperTorqueVertical[t].position.set(a.x,a.y,a.z),r.arrowHelperTorqueVertical[t].setDirection(w.clone().normalize()),r.arrowHelperTorqueVertical[t].setLength(d),r.arrowHelperReferenceTorqueArm[t].geometry.vertices[0].set(a.x,a.y,a.z),r.arrowHelperReferenceTorqueArm[t].geometry.vertices[1].set(l.x,l.y,l.z),r.arrowHelperReferenceTorqueArm[t].geometry.verticesNeedUpdate=!0,r.arrowHelperVeclotyRotational[t].position.set(a.x,a.y,a.z),r.arrowHelperVeclotyRotational[t].setDirection(n.clone().normalize()),r.arrowHelperVeclotyRotational[t].setLength(m),r.arrowHelperVelocityPrecession[t].position.set(a.x,a.y,a.z),r.arrowHelperVelocityPrecession[t].setLength(y),r.arrowHelperVelocityPrecession[t].setDirection(H.clone().normalize())}l=(new THREE.Vector3).setFromSpherical(new THREE.Spherical(e.orbitRadius,Math.PI/2,e.pivot.rotation.y));r.arrowHelperReferenceTorqueAxis.geometry.vertices[0].set(l.x,l.y,l.z),r.arrowHelperReferenceTorqueAxis.geometry.vertices[1].set(-l.x,-l.y,-l.z),r.arrowHelperReferenceTorqueAxis.geometry.verticesNeedUpdate=!0}}!function(){function e(){r.physics(),r.gyroLights.physics(),r.gyroCamera.physics(),r.gyroGyro.physics(),r.gyroArrows.physics(),r.gyroRenderer.renderer.render(r.scene,r.camera),r.frameSkipCount++}var r=new _gyro_scene;r.pause=!0,r.frameRateScale=1,new _gyro_renderer(r),new _gyro_lights(r),new _gyro_camera(r),new _gyro_gyro(r),new _gyro_arrows(r),$('#form input[name="mpause"').prop("checked",r.pause),function(e,r){function o(e){null===a&&(a=e);var c=Math.floor((e-a)/i);c>n&&r({time:e,frame:n=c}),t=requestAnimationFrame(o)}var t,i=1e3/e,a=null,n=-1;t=requestAnimationFrame(o)}(60,e),r.init(),r.gyroRenderer.init(),r.gyroLights.init(),r.gyroCamera.init(),r.gyroGyro.init(),r.gyroArrows.init(),$(document).on("keydown",function(e){switch(e.keyCode){case 80:r.pause=!r.pause,$('#form input[name="mpause"').prop("checked",r.pause)}}),$("#form").on("keydown",function(e){e.stopPropagation()}),$('#form input[name="mpause"').click(function(e){$(this).is(":checked")?r.pause=!0:r.pause=!1}),$('#form input[name="sspeed"').change(function(e){r.frameRateScale=1/parseInt($(this).val())}),$("#form").click(function(e){$("#form, #form *").blur(),$("#canvas").focus(),$("#canvas").click()}),$("#form .button").click(function(e){$("#form").toggleClass("hidden")}),$("#form").on("mousedown",function(e){$("#form").css({opacity:.25})}),$("#form").on("mouseup",function(e){$("#form").css({opacity:1})}),$("#form").on("mouseleave",function(e){$("#form").css({opacity:1})}),$("#canvas").attr("tabindex","-1"),$("#canvas").focus(),$("#canvas").click(),$("canvas").mousedown(function(e){var o=e.pageX,t=e.pageY,i=r.gyroCamera.phi,a=r.gyroCamera.theta;$(this).mousemove(function(e){var n=o-e.pageX,c=t-e.pageY;r.gyroCamera.phi=i+c/256,r.gyroCamera.phi<Math.PI*(5/180)&&(r.gyroCamera.phi=Math.PI*(5/180)),r.gyroCamera.phi>Math.PI-Math.PI*(30/180)&&(r.gyroCamera.phi=Math.PI-Math.PI*(30/180)),r.gyroCamera.theta=a+n/256})}).mouseup(function(e){$(this).unbind("mousemove")}).mouseout(function(e){$(this).unbind("mousemove")}),e()}();
//# sourceMappingURL=gyro.min.js.map